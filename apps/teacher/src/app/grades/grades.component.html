<mat-card>
  <mat-card-header>
    <mat-card-title>{{ 'Grades' | translate }}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="row">
      <mat-form-field class="col-md-4">
        <mat-label>{{ 'Course' | translate }}</mat-label>
        <mat-select [formControl]="course">
          <mat-option *ngFor="let course of courses$ | async" [value]="course">
            {{ course.plan.name }} | {{ course.subject.shortName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="col-md-4">
        <mat-label>{{ 'Group' | translate }}</mat-label>
        <mat-select [formControl]="group">
          <mat-option *ngFor="let group of groups$ | async" [value]="group">
            {{ group.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="col-md-4">
        <mat-label>{{ 'Period' | translate }}</mat-label>
        <mat-select [formControl]="period">
          <mat-option *ngFor="let period of periods$ | async" [value]="period">
            {{ period.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <ng-container *ngIf="!!(selectedGroup$ | async) && period.value">
      <div class="d-flex align-items-center justify-content-between">
        <h5>{{ 'Students' | translate }}</h5>
        <button mat-flat-button color="primary" (click)="addGrade()">
          {{ 'Add grade' | translate }}
        </button>
      </div>
      <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort>
          <ng-container matColumnDef="student" sticky>
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'Student' | translate }}
            </th>
            <td
              mat-cell
              class="d-flex align-items-center"
              *matCellDef="let student"
            >
              <div
                mat-card-avatar
                class="avatar my-2 me-2"
                [style.background-image]="'url(' + student.profilePicURL + ')'"
              ></div>
              {{ student | studentName: 'short' }}
            </td>
          </ng-container>
          <ng-container
            *ngFor="let grade of grades$ | async"
            matColumnDef="{{ grade._id }}"
          >
            <th mat-header-cell *matHeaderCellDef>
              <div class="d-flex align-items-center justify-content-around">
                <span class="title">{{ grade.title }}</span>
                <button mat-icon-button [matMenuTriggerFor]="gradeMenu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #gradeMenu="matMenu">
                  <button mat-menu-item (click)="editGrade(grade)">
                    <mat-icon color="accent">edit</mat-icon>
                    <span>{{ 'Edit' | translate }}</span>
                  </button>
                  <button mat-menu-item>
                    <mat-icon color="warn">delete</mat-icon>
                    <span>{{ 'Delete' | translate }}</span>
                  </button>
                </mat-menu>
              </div>
            </th>
            <td mat-cell *matCellDef="let student">
              <skooltrak-student-grade
                [student]="student"
                [grade]="grade"
              ></skooltrak-student-grade>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="columns"></tr>
          <tr mat-row *matRowDef="let row; columns: columns"></tr>
        </table>
      </div>
    </ng-container>
  </mat-card-content>
</mat-card>
